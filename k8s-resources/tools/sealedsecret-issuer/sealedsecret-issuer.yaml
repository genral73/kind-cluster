apiVersion: v1
kind: Namespace
metadata:
  name: sealedissuer
---
apiVersion: v1
data:
  cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVyakNDQXBhZ0F3SUJBZ0lSQUtybDRDRFVaWWhNWVd0eG5hcEVsRHN3RFFZSktvWklodmNOQVFFTEJRQXcKQURBZUZ3MHlNVEEzTVRVeE5ESXpNVFZhRncwek1UQTNNVE14TkRJek1UVmFNQUF3Z2dJaU1BMEdDU3FHU0liMwpEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUM3YlhJb21GYTE3LzdmaUVNWXk0MGtkVUduK3JjMW9CeHVobmRJCks4ZHM0S2QxYklncGRpdURnK3ZVcHAwRzArZG92SjlPaTJ5d0szRE8xWXUwRkhNNnFEMHg0M3dydEt5UHloR2EKRGhXeG52ZEJha3BmYlBLbGdVL1hsZnlDQ1NxbkhncjVBeUg4L3ErNlEzc2dLTDRlVWhEbndVeVNrNE1hb2txMwp0QS90ZExNVE91bkNES2IraWRSR0xLWG4yVEZPaG9jdzgrYTNGdVV6Smh1dVloUnNtektTdEJpVG9BVExicnFmClZ2eWF2a0Y3WnEyV2JKMUlrdDFLMEZueHdzN2R3VXJGcy9aLzRkeXZWRmRXN3NyT3VERkRvc0ZmcTVtb05lWDAKZnRCYlp0TkdxZlZGb2VsTXV6TnlMd3FDMStqeXdPTWpzRXdMOU02U0Z4K0ZLc3ZTUE1OSGJQZkJtSXU5V2RRMgpMTWtpa1kyU2QwQWNRMVRpQkU3bGdwdllKbU8yQlRoZXU5VXc3eWU3N0gxanRNZU9FUGhmWU5VK0tPajRBS2tVCmxMOXRWZ0xnS21yclFQdjlGdlc3bStmVTlBTXAweGQxME8vV21OLzRCdmxKMkNOMWJQcndSQzYvSjlzb0lzUEcKMXRkWWRMaFIrOXFlaFdRTXVaVTAyNlZ5ZVdZTUc5M0lmc3VkZ1RXT0NOMmpnNlFVUDhDenA0bTJudHFtT2ptTApBV0xPQys3VXM5aUJxc1ZSdFJKYUJSZFJOSSsrbGI4SDdOb0tqb2lMeklCVGRTQTJFVHpMa2p5NTVIaEpmbk1kCktlZ1cyZkxHRWhnMGx0V1A2MHAySERGc3pQSUM0S3FJWVp1eTB0VDhidDY4TlVET0w5Ti9DVFJtOUlBaG5GMnUKd01Ta1dRSURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQUFFd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTgpCZ2txaGtpRzl3MEJBUXNGQUFPQ0FnRUFQQ01RY2VWamFNdWowM3BTMXhKU09ZY1gwL0ptOVpsSzRLelVscEpwCjVCOTFEK0VvY0pBSzR1cXV0OWJIQnlBbWxtUjZMVEFpTll1ZjJBMkZ5UGV4bDRzdXhjSGErRjRGbnYxY1lHR04KQWI0N04yMThXU0cwbDd4ODBNYk5lelZoczdoa0wxTk02OXU1bFBDQ0tDOC96TWhZWUxISWlvUFBGYVNUS1NDegpqVjYzSFdxRkUvWTY2czF0MmdpN29mYkhjbkxKekRvbzhBY2VUZ1R6UzU5N04wNGN1SU9CY1RHVEpBWEJYMmI4CkhmM1FKU1lFS1NBc1JWMTdJN090WUdLQ1lQV1ZaR2thZHhQbGpwOWJVeXR0ckJUalJXSnZWQjFLbDRUN2tjVGYKeEdtZm9ya1prcGVGTGdUUlAyQ084NHlOcy92ZElzK0FZZ3dtSm5pNWU1d2dmUHVEb3BCZks2dFdSbGdla1ZuSQo5Y2JIcVJ4VUdJZmhCOW5VSkd0LzUyL0NrWFBzVFdYV1JkTlAzOGo3QmdjZ3ZzYnQ2WVJIVi8vUUR0RVJSVlFkCjlRU1lxUWs1TDRMYm9UNVZrZkMzUnVUY0JNS1N4V2puMUhkbnp4cGh6Q0kwTEMybWFzL0d0TkIrd1lBMWJycnEKdjNWaE85RkNSUXYzNGE1L0RJeDBWT2pqZmtuL0ZaUDE5QUlFdXdpYmthUnB0TGFjR1Fya1lJSFcrZld1b1JBSgp4dkRnODErVUloRGlqVTg2ejlzNHJuQW1TWHg1dmdaVWtLczROaFVQalZnVTVZb1EvUXZOREl0ajZDWGg2cTNhCmJ0UG9ISEJmQjJoWUhFTVBOTSs5VTN5ZFNHcVg2RlcwMWlzYURLYmdsb0hzdStRb0dZZFJ3YnZvOEZhaE9OaloKc0pJPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
kind: Secret
metadata:
  name: sealedissuer-certificate
  namespace: sealedissuer
type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sealedissuer-deployment
  namespace: sealedissuer
spec:
  revisionHistoryLimit: 0
  replicas: 1
  selector:
    matchLabels:
      app: sealedissuer-frontend
  template:
    metadata:
      labels:
        app: sealedissuer-frontend
    spec:
      volumes:
        - name: certificate-file
          secret:
            secretName: sealedissuer-certificate
      containers:
        - name: sealedissuer
          image: registry.gitlab.com/genral73/k8s-tools/sealedsecret-issuer:latest
          volumeMounts:
            - name: certificate-file
              mountPath: /kubeseal/cert.pem
              subPath: cert.pem
          ports:
            - containerPort: 8080
          imagePullPolicy: Always
          resources:
            requests:
              cpu: "0.2"
              memory: "50Mi"
            limits:
              cpu: "0.25"
              memory: "100Mi"
---
apiVersion: v1
kind: Service
metadata:
  name: sealedissuer-svc
  namespace: sealedissuer  
spec:
  type: ClusterIP
  selector:
    app: sealedissuer-frontend
  ports:
    - name: http
      port: 80
      targetPort: 8080
      protocol: TCP
---
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/ssl-passthrough: "false"
  name: sealedissuer-ingress
  namespace: sealedissuer
spec:
  rules:
    - host: sealedissuer.localhost
      http:
        paths:
          - backend:
              serviceName: sealedissuer-svc
              servicePort: http
            path: /